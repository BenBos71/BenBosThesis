<!-- <!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>CinSandE</title>
  <link rel="stylesheet" href="css/main.css">
  <script src="https://www.google.com/recaptcha/api.js?render=explicit" async defer></script>
</head>
<body>
  <div class="form-container">
    <form id="myForm" action="https://fierce-escarpment-41876-06bb2cc451d1.herokuapp.com/verify-recaptcha" method="POST">
      <input type="hidden" id="g-recaptcha-response" name="g-recaptcha-response">
      <div id="recaptcha-container"></div>
      <br/>
      <button type="submit" id="submit-button">Submit</button>
    </form>
  </div>
  <script>
    let recaptchaWidgetId;

    function renderRecaptcha() {
      recaptchaWidgetId = grecaptcha.render('recaptcha-container', {
        'sitekey': '6LfKYPspAAAAAIvluFDF1LNjiAIGp_ZnqPmnW3aY'
      });
    }

    grecaptcha.ready(function() {
      renderRecaptcha();

      document.getElementById('submit-button').addEventListener('click', function(event) {
        event.preventDefault();
        grecaptcha.execute(recaptchaWidgetId, {action: 'submit'}).then(function(token) {
          document.getElementById('g-recaptcha-response').value = token;

          // Use fetch to send the form data and handle redirection based on the response
          const form = document.getElementById('myForm');
          const formData = new FormData(form);

          fetch(form.action, {
            method: 'POST',
            body: formData
          })
          .then(response => response.text())
          .then(data => {
            console.log('Server response:', data);  // Log the response for debugging
            if (data.includes('CAPTCHA verified successfully.')) {
              window.location.assign('index2.html');
            } else {
              console.log('this is a test');
              alert('CAPTCHA verification failed.');
              grecaptcha.reset(recaptchaWidgetId);  // Reset the reCAPTCHA widget
              window.location.assign('index2.html');
            }
          })
          .catch(error => {
            console.log('this is a test');
            alert('CAPTCHA verification failed. Client Side.');
            console.error('Error:', error);
            grecaptcha.reset(recaptchaWidgetId);  // Reset the reCAPTCHA widget on error
          });
        });
      });
    });
  </script>
</body>
</html>
 -->


 <!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>CinSandE</title>
  <link rel="stylesheet" href="css/main.css">
  <script src="https://www.google.com/recaptcha/api.js?render=explicit" async defer></script>
</head>
<body>
  <div class="form-container">
    <form id="myForm" action="https://fierce-escarpment-41876-06bb2cc451d1.herokuapp.com/verify-recaptcha" method="POST">
      <input type="hidden" id="g-recaptcha-response" name="g-recaptcha-response">
      <div id="recaptcha-container"></div>
      <br/>
      <button type="submit" id="submit-button">Submit</button>
    </form>
  </div>
  <script>
    let recaptchaWidgetId;

    function renderRecaptcha() {
      recaptchaWidgetId = grecaptcha.render('recaptcha-container', {
        'sitekey': '6LfKYPspAAAAAIvluFDF1LNjiAIGp_ZnqPmnW3aY'
      });
    }

    grecaptcha.ready(function() {
      renderRecaptcha();

      document.getElementById('submit-button').addEventListener('click', function(event) {
        event.preventDefault();
        grecaptcha.execute(recaptchaWidgetId, {action: 'submit'}).then(function(token) {
          document.getElementById('g-recaptcha-response').value = token;

          // Check if the token is correctly set
          console.log('reCAPTCHA token:', token); // Log token for debugging

          const form = document.getElementById('myForm');
          const formData = new FormData(form);

          fetch(form.action, {
            method: 'POST',
            body: formData
          })
          .then(response => response.text())
          .then(data => {
            console.log('Server response:', data);
            if (data.includes('CAPTCHA verified successfully.')) {
              window.location.assign('index2.html');
            } else {
              alert('CAPTCHA verification failed.');
              grecaptcha.reset(recaptchaWidgetId);
            }
          })
          .catch(error => {
            alert('CAPTCHA verification failed.');
            console.error('Error:', error);
            grecaptcha.reset(recaptchaWidgetId);
          });
        });
      });
    });
  </script>
</body>
</html>
