<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>CinSandE</title>
    <link rel="stylesheet" href="../css/main.css">
    <script>
        window.addEventListener('load', function() {
            // Set the source of the image element to display the random image
            // Retrieve the image_dir value from sessionStorage
            var imageDir = sessionStorage.getItem("image_dir");

            // Check if the value is not "none"
            if (imageDir !== "none") {
                // Update the src attribute of the image element
                document.getElementById("image_display").src = "../images/survey_images/" + imageDir + 
            "/23.jpg";
            }
            document.getElementById("sentence").textContent = "A baby cried in the next room.";

            // Get dropdown var
            var dropdownMenu = document.getElementById("myDropdown");
            dropdownMenu.style.display = "none";
        });
    </script>
  </head>
  <body>
    <img src="../images/wsuLogo.png" alt="Weber State University Logo" class="logo"/>
    <br />
    <div class="content">
        <img id="image_display" src="" alt="" class="ind_pic"/>
        <br />
        <p id="sentence"></p>
        <br />
        <form id="demoForm" >
            <div class="dropdown">
                <button type="button" onclick="toggleDropdown()" class="dropbtn" id="dropbtn">Select an option:</button>
                <div id="myDropdown" class="dropdown-content">
                    <a href="#" onclick="selectOption('Happy')">Happy</a>
                    <a href="#" onclick="selectOption('Sad')">Sad</a>
                </div>
            </div>
            <input type="hidden" id="selectedOption" name="selectedOption" value="">
            <input type="submit"  value="Next"/>
        </form>
    </div>
    <br />
    <script type="text/javascript">
        document.getElementById('demoForm').addEventListener('submit', function(event) {
            event.preventDefault(); // Prevent form from submitting the traditional way
            validateForm(event); // Call the validation function
        });

        function toggleDropdown() {
            var dropdownMenu = document.getElementById("myDropdown");
            if (dropdownMenu.style.display === "none") {
                dropdownMenu.style.display = "block";
            }
            else {
                dropdownMenu.style.display = "none";
            }
        }

        function selectOption(optionText) {
            var dropdownButton = document.getElementById("dropbtn");
            dropdownButton.textContent = optionText;

            var dropdownMenu = document.getElementById("myDropdown");
            dropdownMenu.style.display = "none"; 
            
            document.getElementById("selectedOption").value = optionText;
        }

        function validateForm(event) {
            var selectedOption = document.getElementById("selectedOption").value;
            if (!selectedOption) {
                alert("Please select an option from the dropdown.");
                event.preventDefault();
            }
            else {
                next();
            }
        }

        window.onclick = function(event) {
            if (!event.target.matches('.dropbtn')) {
                var dropdowns = document.getElementsByClassName("dropdown-content");
                for (var i = 0; i < dropdowns.length; i++) {
                    var openDropdown = dropdowns[i];
                    if (openDropdown.style.display === "block") {
                        openDropdown.style.display = "none";
                    }
                }
            }
        }

        function next() {
            let emotions = JSON.parse(sessionStorage.getItem("emotions"));
            emotions.push(document.getElementById("selectedOption").value);
            sessionStorage.setItem("emotions", JSON.stringify(emotions));
            window.location.assign('survey_24.html');
        }
    </script>
  </body>
</html>